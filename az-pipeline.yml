trigger:
- feature/ci

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '10.x'
  displayName: 'Install Node.js'

# - script: |
#     sudo apt-get install -y gettext-base;
#     sudo echo 'deb http://dl.google.com/linux/chrome/deb/ stable main' > /etc/apt/sources.list.d/chrome.list
#     sudo wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -
#     sudo set -x && apt-get update && apt-get install -y xvfb google-chrome-stable
#     sudo wget -q -O /usr/bin/xvfb-chrome https://bitbucket.org/atlassian/docker-node-chrome-firefox/raw/ff180e2f16ea8639d4ca4a3abb0017ee23c2836c/scripts/xvfb-chrome
#     sudo ln -sf /usr/bin/xvfb-chrome /usr/bin/google-chrome
#     sudo chmod 755 /usr/bin/google-chrome

- script: |
    npm install -g @angular/cli
    npm install
  displayName: 'npm install'


# - script: |
#     wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
#     sudo apt install ./google-chrome-stable_current_amd64.deb -y
#   displayName: 'install chrome'

- script: |
    sudo apt-get install -y libappindicator1 fonts-liberation
    mkdir temp & cd temp
    wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    sudo dpkg -i google-chrome*.deb
  displayName: 'install chrome'

   
- script: |
    ng e2e 
  displayName: 'ng e2e'

- script: |
    ng test --watch=false --browsers=ChromeHeadless
  displayName: 'ng test'
